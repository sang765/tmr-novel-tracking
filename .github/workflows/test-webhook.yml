name: Test Webhook

on:
  workflow_dispatch:

jobs:
  test-webhook:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Test webhook
        env:
          UPDATE_WEBHOOK_URL: ${{ secrets.UPDATE_WEBHOOK_URL }}
        run: |
          python -c "
          import os
          import requests
          webhook_url = os.getenv('UPDATE_WEBHOOK_URL')
          if not webhook_url:
              print('ERROR: UPDATE_WEBHOOK_URL secret is not set or empty')
              exit(1)
          print('Secret is set, sending test message...')
          response = requests.post(webhook_url, json={'content': 'Test message from GitHub Actions'}, timeout=10)
          response.raise_for_status()
          print('Test message sent successfully!')
          "